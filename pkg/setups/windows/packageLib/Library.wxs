<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
  <Fragment>
    <DirectoryRef Id="ProgramFilesFolder">
      <Directory Id="MicrosoftSdks" Name="Microsoft SDKs">
        <Directory Id="NuGetPackages" Name="NuGetPackages" />
      </Directory>
    </DirectoryRef>
    <DirectoryRef Id="TARGETDIR">
      <Directory Id="CommonAppDataFolder">
        <Directory Id="ProgramDataNuGet" Name="NuGet">
          <Directory Id="ProgramDataNuGetConfig" Name="Config" />
        </Directory>
      </Directory>
    </DirectoryRef>

    <!-- Register the packages folder as a machine-wide feed -->
    <DirectoryRef Id="ProgramDataNuGetConfig">
      <Component Id="C_OfflinePackagesConfig" Guid="*">
        <File Id="filOfflinePackagesConfig" KeyPath="yes" Source="Microsoft.VisualStudio.Offline.config" />
        <util:XmlConfig Id="xmlConfigSetOfflinePackagesFolder" 
                        Action="create"
                        ElementPath="/configuration/packageSources/add"
                        File="[#filOfflinePackagesConfig]"
                        Name="value"
                        Node="value"
                        On="install"
                        PreserveModifiedDate="yes"
                        Value="[NuGetPackages]" />
      </Component>
    </DirectoryRef>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="CG_NuGetPkgLib">
      <ComponentRef Id="C_OfflinePackagesConfig" />
    </ComponentGroup>
  </Fragment>
</Wix>
